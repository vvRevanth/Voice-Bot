<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VC Voice Chat â€” Clean UI</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --primary-purple: #8b5cf6;
    --secondary-blue: #3b82f6;
    --dark-bg: #f8fafc;
    --card-bg: #ffffff;
    --border-color: #e5e7eb;
    --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.08);
    --input-mic-color: #64748b;
}

body {
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
    background-color: var(--dark-bg);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.main-container {
    width: 1000px;
    height: 650px;
    max-width: 95%;
    background: var(--card-bg);
    border-radius: 16px;
    box-shadow: var(--shadow-light);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    border-bottom: 1px solid var(--border-color);
}

.logo-section {
    display: flex;
    align-items: center;
    font-size: 14px;
    color: #64748b;
}

.logo-section .vc-logo {
    background: linear-gradient(45deg, var(--secondary-blue), var(--primary-purple));
    color: #ffffff;
    font-weight: 700;
    padding: 5px 8px;
    border-radius: 6px;
    margin-right: 10px;
    font-size: 16px;
}

.content-area {
    display: flex;
    flex-grow: 1;
    overflow: hidden;
}

.controls-panel {
    width: 350px;
    padding: 25px;
    border-right: 1px solid var(--border-color);
    overflow-y: auto;
}

.conversation-panel {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    padding: 25px;
    overflow: hidden;
}

.controls-panel h3,
.conversation-panel h3 {
    font-size: 16px;
    color: #334155;
    margin-top: 0;
    margin-bottom: 15px;
    font-weight: 600;
}

#start-speaking, #stop-listening, #send-btn {
    cursor: pointer;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    padding: 12px 20px;
    transition: all 0.2s;
}

#start-speaking {
    background: linear-gradient(90deg, #6366f1, #a855f7);
    color: #fff;
    box-shadow: 0 4px 10px rgba(99,102,241,0.4);
    margin-bottom: 10px;
}

#start-speaking:hover { opacity: 0.9; }

#stop-listening {
    background-color: #fff;
    color: #94a3b8;
    border: 1px solid #e2e8f0;
}

#stop-listening:hover { background-color: #f8fafc; }

.control-group {
    margin-top: 25px;
}

.control-group label {
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
    color: #475569;
    font-weight: 500;
}

select, input[type="range"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #cbd5e1;
    border-radius: 6px;
    box-sizing: border-box;
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--secondary-blue);
    cursor: pointer;
    box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
}

.examples { margin-top: 25px; }

.example-btn {
    display: inline-block;
    padding: 6px 15px;
    margin-right: 8px;
    margin-bottom: 8px;
    border: 1px solid #cbd5e1;
    border-radius: 5px;
    background-color: #fff;
    font-size: 14px;
    color: #475569;
    cursor: pointer;
}

.example-btn:hover { background-color: #f8fafc; }

#chat-box {
    flex-grow: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding-right: 15px;
    padding-bottom: 20px;
    min-height: 400px;
}

.message {
    padding: 10px 15px;
    border-radius: 18px;
    max-width: 80%;
    word-wrap: break-word;
    font-size: 15px;
    line-height: 1.4;
    position: relative;
}

.bot-message {
    align-self: flex-start;
    background-color: #f1f5f9;
    color: #334155;
    border-bottom-left-radius: 2px;
}

.user-message {
    align-self: flex-end;
    background-color: var(--secondary-blue);
    color: #fff;
    border-bottom-right-radius: 2px;
}

.speaking-ball {
    position: absolute;
    top: 50%;
    right: -25px;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: var(--primary-purple);
    animation: pulse 0.8s infinite alternate;
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(1.5); opacity: 0.5; }
}

.input-container {
    display: flex;
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
    position: relative;
}

#user-input-wrapper { flex: 1; position: relative; margin-right: 10px; }

input[type="text"] {
    width: 100%;
    padding: 12px 40px 12px 15px;
    border-radius: 8px;
    border: 1px solid #cbd5e1;
    outline: none;
    font-size: 15px;
    box-sizing: border-box;
}

#mic-icon {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--input-mic-color);
    cursor: pointer;
    font-size: 18px;
}

#send-btn {
    padding: 0 25px;
    border-radius: 8px;
    background-color: var(--secondary-blue);
    color: #fff;
    font-weight: 500;
    border: none;
}
#send-btn:hover { background-color: #2563eb; }

</style>
</head>
<body>
<div class="main-container">
    <div class="header">
        <div class="logo-section">
            <span class="vc-logo">VC</span> Voice Chat Bot
        </div>
    </div>

    <div class="content-area">
        <div class="controls-panel">
            <h3>Controls</h3>
            <button id="start-speaking">Start speaking</button>
            <button id="stop-listening" style="display:none;">Stop</button>

            <div class="control-group">
                <label for="voice-select">Voice</label>
                <select id="voice-select">
                    <option value="Microsoft David - English (United States)">Microsoft David - English (United States)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="speech-rate">Speech rate</label>
                <input type="range" id="speech-rate" min="0.5" max="2" step="0.1" value="1.0">
            </div>

            <div class="examples">
                <label style="font-size: 14px; color: #475569; font-weight: 500;">Examples</label>
                <div style="margin-top: 5px;">
                    <button class="example-btn">Life story</button>
                    <button class="example-btn">Superpower</button>
                    <button class="example-btn">Top growth areas</button>
                </div>
            </div>
        </div>

        <div class="conversation-panel">
            <h3>Conversation</h3>
            <div id="chat-box">
                <div class="bot-message message">Hi â€” ask me anything. I can speak my answers aloud.</div>
            </div>

            <div class="input-container">
                <div id="user-input-wrapper">
                    <input type="text" id="user-input" placeholder="Type or speak...">
                    <span id="mic-icon">ðŸŽ¤</span>
                </div>
                <button id="send-btn">Send</button>
            </div>
        </div>
    </div>
</div>

<script>
const chatBox = document.getElementById("chat-box");
const userInput = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");
const startSpeakingBtn = document.getElementById("start-speaking");
const stopListeningBtn = document.getElementById("stop-listening");
const micIcon = document.getElementById("mic-icon");
const speechRateInput = document.getElementById("speech-rate");
const voiceSelect = document.getElementById("voice-select");

// Speech recognition setup
let recognition = null;
if (window.SpeechRecognition || window.webkitSpeechRecognition) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.lang = "en-US";
    recognition.interimResults = false;

    const startRecognition = () => {
        recognition.start();
        startSpeakingBtn.style.display = 'none';
        stopListeningBtn.style.display = 'block';
        micIcon.style.color = 'red';
    };

    startSpeakingBtn.addEventListener("click", startRecognition);
    micIcon.addEventListener("click", startRecognition);

    stopListeningBtn.addEventListener("click", () => {
        recognition.stop();
        startSpeakingBtn.style.display = 'block';
        stopListeningBtn.style.display = 'none';
        micIcon.style.color = 'var(--input-mic-color)';
    });

    recognition.onresult = (e) => {
        userInput.value = e.results[0][0].transcript;
        sendMessage();
    };

    recognition.onend = () => {
        startSpeakingBtn.style.display = 'block';
        stopListeningBtn.style.display = 'none';
        micIcon.style.color = 'var(--input-mic-color)';
    };
}

// Send message
sendBtn.addEventListener("click", sendMessage);
userInput.addEventListener("keydown", e => { if(e.key==="Enter") sendMessage(); });
document.querySelectorAll('.example-btn').forEach(btn => {
    btn.addEventListener('click', () => { userInput.value = btn.textContent; sendMessage(); });
});

async function sendMessage() {
    const message = userInput.value.trim();
    if (!message) return;
    appendMessage("user", message);
    userInput.value = "";

    let botMsgElement = appendMessage("bot", "Thinking...", false, true);

    try {
        const res = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
        });

        const data = await res.json();
        updateBotMessage(botMsgElement, data.reply);
        speakText(data.reply);
    } catch (err) {
        updateBotMessage(botMsgElement, "AI: Failed to connect to AI service.", true);
        console.error(err);
    }
}

function appendMessage(sender, text, isError=false, showBall=false) {
    const msg = document.createElement("div");
    msg.className = `${sender}-message message`;
    msg.textContent = text;

    if (isError) {
        msg.style.color = '#ef4444';
        msg.style.border = '1px solid #fecaca';
        msg.style.backgroundColor = '#fef2f2';
    }

    if (showBall && sender === "bot") {
        const ball = document.createElement("span");
        ball.className = "speaking-ball";
        msg.appendChild(ball);
    }

    chatBox.appendChild(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
    return msg;
}

function updateBotMessage(msgElement, newText, isError=false) {
    msgElement.textContent = newText;
    if (isError) {
        msgElement.style.color = '#ef4444';
        msgElement.style.border = '1px solid #fecaca';
        msgElement.style.backgroundColor = '#fef2f2';
    }
    const ball = msgElement.querySelector('.speaking-ball');
    if (ball) ball.remove();
    chatBox.scrollTop = chatBox.scrollHeight;
}

function speakText(text){
    const speech = new SpeechSynthesisUtterance(text);
    const selectedOption = voiceSelect.options[voiceSelect.selectedIndex];
    const voiceName = selectedOption.getAttribute('data-name');
    const voices = window.speechSynthesis.getVoices();
    const selectedVoice = voices.find(v => v.name === voiceName);
    if (selectedVoice) speech.voice = selectedVoice;
    speech.rate = parseFloat(speechRateInput.value);

    const lastBotMessage = Array.from(chatBox.querySelectorAll('.bot-message')).pop();
    if (lastBotMessage) {
        const ball = document.createElement("span");
        ball.className = "speaking-ball";
        lastBotMessage.appendChild(ball);
        speech.onend = () => { if (ball) ball.remove(); };
        setTimeout(() => { if (ball) ball.remove(); }, (text.length/15)*1000 + 500);
    }

    window.speechSynthesis.speak(speech);
}
</script>
</body>
</html>
